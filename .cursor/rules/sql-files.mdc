---
globs: *.sql, migrations/*.sql
---

# SQL Files (.sql) Rules üóÉÔ∏è

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–∏–≥—Ä–∞—Ü–∏–π
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥ (forward-only)
- –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–π

## –°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

### –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
- –§–æ—Ä–º–∞—Ç: `V{–≤–µ—Ä—Å–∏—è}__{–æ–ø–∏—Å–∞–Ω–∏–µ}.sql`
- –ü—Ä–∏–º–µ—Ä—ã:
  - `V1__initial_schema.sql`
  - `V2__add_soft_delete.sql`
  - `V14__create_usage_table.sql`

### –û–±—ä–µ–∫—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü—ã**: snake_case —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `xi_` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `xi_users`, `xi_messages`)
- **–°—Ç–æ–ª–±—Ü—ã**: snake_case (–Ω–∞–ø—Ä–∏–º–µ—Ä, `user_id`, `created_at`, `is_active`)
- **–ò–Ω–¥–µ–∫—Å—ã**: `idx_{table}_{columns}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `idx_users_telegram_id`)
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: `fk_{table}_{column}` –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: `seq_{table}_{column}`

## –°—Ç–∏–ª—å SQL –∫–æ–¥–∞

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ SQL –≤ –í–ï–†–•–ù–ï–ú –†–ï–ì–ò–°–¢–†–ï
- –ò–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
- –û—Ç—Å—Ç—É–ø—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```sql
CREATE TABLE xi_users (
    id BIGSERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL UNIQUE,
    username VARCHAR(255),
);

CREATE INDEX idx_users_telegram_id ON xi_users(telegram_id);
CREATE INDEX idx_users_active ON xi_users(is_active) WHERE is_active = TRUE;
```

## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ Xi Manager

### –¢–∞–±–ª–∏—Ü—ã –ø—Ä–æ–µ–∫—Ç–∞
- **xi_users**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram
- **xi_messages**: –°–æ–æ–±—â–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
- **xi_modes**: –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
- **xi_selected_modes**: –í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ä–µ–∂–∏–º—ã
- **xi_donations**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–Ω–∞—Ç–∞—Ö
- **xi_pins**: –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **xi_usage**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ò–Ω–¥–µ–∫—Å—ã
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö WHERE —É—Å–ª–æ–≤–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–±–∞–≤–ª—è–π—Ç–µ —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫