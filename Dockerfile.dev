FROM golang:1.25.5-alpine3.21

WORKDIR /workspace

RUN apk --no-cache add \
    git \
    build-base \
    pkgconfig \
    python3 \
    python3-dev \
    py3-pip \
    ca-certificates \
    tzdata \
    curl \
    wget \
    bash \
    && update-ca-certificates

RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH" \
    PIP_NO_CACHE_DIR=1 \
    CGO_ENABLED=1 \
    GOMODCACHE=/go/pkg/mod \
    GOCACHE=/home/devuser/.cache/go-build

RUN pip install --upgrade pip && pip install telegramify-markdown

RUN adduser -D -s /bin/bash -G root devuser \
    && mkdir -p /go/bin /go/pkg/mod /home/devuser/.cache/go-build \
    && chown -R devuser:root /go /home/devuser/.cache

USER devuser

RUN go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest \
    && go install github.com/air-verse/air@latest

CMD ["sleep", "infinity"]